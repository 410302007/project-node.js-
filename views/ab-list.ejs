<%- include('parts/html-head') %>
<%- include('parts/navbar') %>

<div class="container">
  <div class="row">
    <div class="col">
      <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-center">
          <li class="page-item <%= page == 1 ? 'disabled' : '' %>">
            <a class="page-link" href="?page=<%= page == 1 %>"><i class="fa-solid fa-circle-arrow-left"></i></a>
          </li>
          <% for(let i=page-5; i<=page+5; i++) 
          if(i>=1 && i<=totalPages){ %>
            <li class="page-item <%= i==page ? 'active' : '' %>">
            <a class="page-link" href="?page=<%= i %>"><%= i %></a>
            </li>
          <% } %>
          <li class="page-item <%= page == totalPages ? 'disabled' : '' %>">
            <a class="page-link" href="?page=<%= totalPages %>">
              <i class="fa-solid fa-circle-arrow-right"></i>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
  <div class="row">
    <div class="col">
      <table class="table table-striped table-bordered">
        <thead>
          <tr>
            <th scope="col">會員編號</th>
            <th scope="col">姓名</th>
            <th scope="col">信箱</th>
            <th scope="col">手機</th>
            <th scope="col">生日</th>
            <th scope="col">地址</th>
            <th scope="col">寵物種類</th>
            <th scope="col">會員狀態</th>
            <th scope="col">創建時間</th>
            <th scope="col">刪除</th>
            <th scope="col">修改</th>
          </tr>
        </thead>
        <tbody>
          <% for(let r of rows){ %>
          <tr>
            <td><%=r.mid %></td>
            <td><%=r.name %></td>
            <td><%=r.email %></td>
            <td><%=r.mobile %></td>
            <td><%= r.birthday && toDateString(r.birthday) %></td>
            <td><%=r.address%></td>
            <td><%= r.pet_type==1 ? '貓' :'狗' %></td>
            <td><%= r.member_status==1 ? '正常' :'停權' %></td>
            <td><%= toDatetimeString(r.created_at) %></td>
            <td>
              <a href="javascript:deleteItem(<%= r.mid%>)">
                <i class="fa-solid fa-trash"></i>
              </a>
            </td>
            <td>
              <a href="<%= baseUrl%>/edit/<%= r.mid%>">
                <i class="fa-solid fa-pen-to-square"></i>
              </a>
            </td>
          </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<%- include('parts/scripts') %>
<script>
  function deleteItem(mid){
    if(! confirm(`是否要刪除編號為 ${mid} 的資料`)){
       return;  //回答false->不做->返回 ; true ->往下進行
    }
    fetch(`<%= baseUrl %>/${mid}`,{
      method:'DELETE'
    })
    .then(r=>r.json())
    .then(data=>{
      console.log(data);
      if(data.success){
        location.reload(); //刪除成功->轉向
      }
    })
  }  
</script>
<%- include('parts/html-foot') %>
